Options -Indexes

<IfModule mod_rewrite.c>
  RewriteEngine On

  RewriteCond %{REQUEST_URI} !^/billing/webhook\.php$
  RewriteCond %{HTTPS} !=on
  RewriteCond %{HTTP:X-Forwarded-Proto} !https [NC]
  RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

  RewriteRule ^(?:data|private|includes)(?:/|$) - [F,L]
  
  # Block sensitive root files
  RewriteRule \.(?:json|lock|md|env.*|yml)$ - [F,L]

  RewriteRule ^sitemap\.xml$ /sitemap.php [L]

  RewriteRule ^about/?$ /about.php [L,QSA]

  RewriteRule ^prompts/?$ /prompts/index.php [L,QSA]
  RewriteRule ^prompts/([a-z0-9-]+)/([a-z0-9-]+)/?$ /prompts/template.php?slug=$1&situation=$2 [L,QSA]
  RewriteRule ^prompts/([a-z0-9-]+)/?$ /prompts/template.php?slug=$1 [L,QSA]

  RewriteRule ^situations/([a-z0-9-]+)/?$ /situations/template.php?slug=$1 [L,QSA]

  RewriteRule ^tools/prompt-generator/?$ /tools/prompt-generator.php [L,QSA]
  
  RewriteRule ^course/?$ /course.php [L,QSA]
  RewriteRule ^organizations/?$ /organizations.php [L,QSA]

  RewriteRule ^members/dashboard/?$ /members/dashboard.php [L,QSA]
  RewriteRule ^members/library/?$ /members/library.php [L,QSA]
  RewriteRule ^members/account/?$ /members/account.php [L,QSA]

  RewriteRule ^auth/login/?$ /auth/login.php [L,QSA]
  RewriteRule ^auth/register/?$ /auth/register.php [L,QSA]
  RewriteRule ^auth/logout/?$ /auth/logout.php [L,QSA]
  RewriteRule ^auth/forgot-password/?$ /auth/forgot-password.php [L,QSA]

  RewriteRule ^billing/checkout/?$ /billing/checkout.php [L,QSA]
  RewriteRule ^billing/success/?$ /billing/success.php [L,QSA]
  RewriteRule ^billing/webhook/?$ /billing/webhook.php [L,QSA]

  RewriteRule ^blog/?$ /blog/index.php [L,QSA]
  RewriteRule ^blog/([a-z0-9-]+)/?$ /blog/template.php?slug=$1 [L,QSA]
</IfModule>

<IfModule mod_headers.c>
  Header always set X-Content-Type-Options nosniff
  Header always set X-Frame-Options DENY
  Header always set X-XSS-Protection "1; mode=block"
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css application/javascript application/json application/xml image/svg+xml
</IfModule>

<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType font/woff2 "access plus 1 year"
</IfModule>
